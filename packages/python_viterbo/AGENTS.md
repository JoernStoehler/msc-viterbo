# AGENTS (python_viterbo)
- Purpose: Python experiments for data science, ML, and visualization.
- Orchestration layer, uses the `packages/rust_viterbo/` via FFI for core algorithms.

## Code Conventions
- Follow best practices for machine learning and data science in Python.
- Toolchain: Python 3.12 via `uv`; per-worktree `.venv`; `uv.lock` pinned.
- Commands:
  - `scripts/lint.sh`: (`ruff format`, `ruff check --fix`, `pyright`).
  - `scripts/smoke-test.sh`: (`pytest tests/smoke`).
  - `uv run pytest <args>`: targeted tests, e.g. for expensive `tests/e2e/`.
- Layout:
  - `src/viterbo/experiments/<experiment>/`: self-contained isolated experiment.
  - `src/viterbo/experiments/<experiment>/stage_<stage>.py`: entrypoints.
  - `src/viterbo/common/`: stable shared helpers. Avoid premature abstraction.
  - `configs/experiments/<consumer>/<variant>.json`: config files.
  - `data/experiments/<producer>/<variant>/`: data artifacts. stored in git lfs.
- Docstrings include input/output, side effects, shapes/dtypes, and the contract.
- Basic type hints; prefer pure functions where practical.
- Code comments to explain the why behind non-obvious decisions.
- Stages must be runnable via `uv run python -m viterbo.experiments.<experiment>.stage_<stage> --config configs/experiments/<experiment>/<variant>.json`.

## Testing
- Follow best practices for testing in machine learning and data science.
- Write fast smoke unit tests under `tests/smoke` to catch regressions and verify correctness, but only if worth the creation and maintenance cost.
- Write e2e tests to assert input & output properties of stages under `tests/e2e/experiments/<experiment>/test_stage_<stage>.py`. Use a `test` variant with small data for speed.

## Plots and Visualizations
- Generated by Python stages; store under `packages/latex_viterbo/assets/`.
- LaTeX only includes assets; Python takes care of layout, style, regeneration.

## Rust FFI
- Maturin/PyO3 bindings, ready to use.
- Smoke tests to detect API drift.
- For more info see `packages/rust_viterbo/agent_docs/python-ffi-with-pyo3-maturin.md`
