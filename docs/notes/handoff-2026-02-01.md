# Handoff: Issue #155 Investigation

**Date:** 2026-02-01
**Branch:** `155-random-polytope-failures`
**Status:** Bug identified, not yet fixed

## Current State

**Tests:** 125 pass, 2 fail (both at seed 2661)
- `prop_transition_graph_connected`
- `prop_flow_map_preserves_containment`

**Uncommitted changes:**
- `tube/src/constants.rs` - Added `EPS_RECONSTRUCTION`
- `tube/src/preprocess.rs` - Diagnostic test + tolerance fix
- `tube/src/types.rs` - Added `TubeError::DegenerateTwoFace`
- `docs/notes/lemma-no-sink-2faces.md` - Important context (untracked)

## The Bug

Proptest found seed 2661 produces **sink 2-faces** - 2-faces with zero outgoing transitions.

Run this to see the diagnostic output:
```bash
cd /workspaces/worktrees/155-random-polytope-failures/packages/rust_viterbo
cargo test -p tube --lib test_seed_2661 -- --nocapture
```

**Key finding:** Facets 3 and 5 never appear as entry facets in any 2-face. This causes 7 sink 2-faces.

## Critical Context

**Jörn's Lemma (unproven but believed true):**
> For any convex polytope K ⊂ ℝ⁴ without Lagrangian 2-faces, every 2-face has at least one outgoing transition. No sink 2-faces exist.

See `docs/notes/lemma-no-sink-2faces.md` for details.

**Implication:** The existence of sink 2-faces indicates a BUG in the code, not a geometric property to filter out. Do NOT add filters to skip these polytopes.

## Where to Look for the Bug

1. **2-face enumeration** - Are we missing some 2-faces?
2. **Flow direction computation** - Is ω(n_i, n_j) computed correctly?
3. **Transition building** - Are transitions created for all valid 2-face pairs?
4. **Lagrangian detection** - Are there Lagrangian 2-faces we're not detecting?

## Next Steps

1. Add more diagnostics to `test_seed_2661_transition_graph` to check:
   - Which facet pairs are adjacent (share vertices)?
   - For each adjacent pair, is there a 2-face? With what omega?
   - Are any 2-faces missing?

2. Compare enumerated 2-faces against ground truth adjacency from vertices.

3. Find and fix the bug.
